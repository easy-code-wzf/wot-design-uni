import{d as s,X as e,v as a,o,c as r,w as t,x as p,p as n,n as l,y as m,i as c}from"./index-WwrgI7Rh.js";import{a4 as i,c as u,d as f,B as d,q as g,a5 as h,T as y,O as b,b as w}from"./page-wraper.XLZNc_u_.js";import{u as v}from"./useChildren.Da1LiOi9.js";const k=w(s({name:"wd-form",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:i,setup(s,{expose:i}){const{show:w}=u("wd-form-toast"),k=s,{children:x,linkChildren:C}=v(b);let j=e({});function T(s){s?j[s]="":Object.keys(j).forEach((s=>{j[s]=""}))}return C({props:k,errorMessages:j}),a((()=>k.model),(()=>{k.resetOnChange&&T()}),{immediate:!0,deep:!0}),i({validate:async function(s){const e=[];let a=!0;const o=[],r=function(){const s=y(k.rules);return x.forEach((e=>{g(e.prop)&&g(e.rules)&&e.rules.length&&(s[e.prop]?s[e.prop]=[...s[e.prop],...e.rules]:s[e.prop]=e.rules)})),s}(),t=s?{[s]:r[s]}:r;for(const p in t){const s=t[p],r=d(k.model,p);if(s&&s.length>0)for(const t of s){if(t.required&&(!g(r)||""===r)){e.push({prop:p,message:t.message}),a=!1;break}if(t.pattern&&!t.pattern.test(r)){e.push({prop:p,message:t.message}),a=!1;break}const{validator:s,...n}=t;if(s){const l=s(r,n);h(l)?o.push(l.then((s=>{"string"==typeof s?(e.push({prop:p,message:s}),a=!1):"boolean"!=typeof s||s||(e.push({prop:p,message:t.message}),a=!1)})).catch((s=>{const o="string"==typeof s?s:s.message;e.push({prop:p,message:o||t.message}),a=!1}))):l||(e.push({prop:p,message:t.message}),a=!1)}}}return await Promise.all(o),function(s){const e=s.filter((s=>s.message));e.length&&("toast"===k.errorType?w(e[0].message):"message"===k.errorType&&e.forEach((s=>{j[s.prop]=s.message})))}(e),a&&(s?T(s):T()),{valid:a,errors:e}},reset:function(){T()}}),(s,e)=>{const a=c;return o(),r(a,{class:l(`wd-form ${s.customClass}`),style:m(s.customStyle)},{default:t((()=>[p(s.$slots,"default",{},void 0,!0),"toast"===k.errorType?(o(),r(f,{key:0,selector:"wd-form-toast"})):n("",!0)])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-dfab3d6b"]]);export{k as _};
